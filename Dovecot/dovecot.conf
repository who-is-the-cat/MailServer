###
### Конфигурационный файл Dovecot для SOGo
###

##
## Используемые почтовые протоколы.
##

# Подключаем файлы конфигурации используемых протоколов.
#
!include_try /usr/share/dovecot/protocols.d/*.protocol


###
### /conf.d/10-auth.conf
###

##
## Процесс аутентификации.
##

# Запрет аутентификации открытым текстом. Отключает метод аутентификации 
# LOGIN и другие методы аутентификации открытым текстом, если клиент 
# подключается не через защищенное соединение  SSL/TLS. 
#
# ВАЖНО: если удаленный IP-адрес совпадает с локальными IP (т.е. вы 
# подключаетесь с того же компьютера), то соединение считается безопасным и 
# аутентификация открытым текстом возможна.
#
disable_plaintext_auth = yes

# Master users (мастер-пользователи)- пользователи, которые могут осуществлять 
# аутентификацию под другой учетной записью (например, администратор может 
# выполнить вход в любой почтовый аккаунт под своей учетной записью.) Чтобы
# разрешить мастер-пользователю вход через обычную строку ввода логина (т.е.,
# не используя SASL-механизм аутентификации), следует задать символ
# разделителя. Используется конструкция <username><separator><master username>.
# Хорошим выбором считается символ "*".
#
auth_master_user_separator = *

# Список разрешенных методов аутентификации (методы разделяются пробелами).
# ВАЖНО: следует учитывать значение параметра disable_plaintext_auth
#
auth_mechanisms = plain


###
### /conf.d/10-logging.conf
###

##
## Расположение лог-файла
##

# Файл, в который записываются сообщения об ошибках. 
#
log_path = /var/log/dovecot.message

##
## Ведение логов и отладка
##

# Запись в лог о недачных попытках и причине входа.
# 
auth_verbose = yes

# Вывод отладочных сообщений о проблемах с письмами.
#
mail_debug = no

##
## Формат лог-сообщений
##

# Префикс для каждой строки в лог-файле.
#
log_timestamp = "%Y-%m-%d %H:%M:%S "


###
### /conf.d/10-mail.conf
###

##
## Пути к почтовым ящикам и пространство имен
##

# Расположение почтовых ящиков. По-умолчанию не задано, поэтому Dovecot 
# попытается найти почтовые ящики самостоятельно. Если у пользователя почты нет
# ни одного письма, автоматический поиск работать не будет. Поэтому следует 
# указать полный путь.
#
# Специальные переменные, которые можно использовать:
#	%u - имя пользователя
#	%n - взять имя пользователя из конструкции user@domain. Если нет
#	     домена, то будет соответствовать %u.
#	%d - взять домен из конструкции user@domain. Останется пустым, если нет
#	     домена.	
#	%h - домашняя директория
#
mail_location = maildir:/var/mail/%u

# Системные пользователь и группа, которые используются для доступа к почтовым
# ящикам. 
#
mail_uid = vmail
mail_gid = vmail

# Пространство имен для собственных почтовых каталогов пользователя. 
#
namespace {

  # Тип пространства имен
  type = private
  
  # Используемый разделитель. Рекомендуется использовать один и тот же для всех
  # пространств имен. 
  separator = /

  # Префикс для доступа к пространству имен (например "Public /"). Должен быть 
  # уникальным. 
  prefix =

  # Имеется ли в данном пространстве имен папка ВХОДЯЩИЕ (INBOX). Может быть
  # только один INBOX.
  inbox = yes

  # Настройки папки ВХОДЯЩИЕ
  mailbox INBOX {
    
    # Автоматическое создание
    auto = create
  }
}

# Пространство имен для доступа к почтовым ящикам, которые были расшарены
#
namespace {
  
  # Тип пространства имен
  type = shared
  
  # Используемый разделитель. Рекомендуется использовать один и тот же для всех
  # пространств имен.
  separator = /
  
  # Префикс для доступа к пространству имен (например "Public /"). Должен быть
  # уникальным.
  prefix = shared/%%u/##

  # Местоположение почтовых ящиков других пользователей.
  # %% - переменные пользователя, расшарившего ресурс.
  # ~/ - переменные залогинившегося пользователя.
  location = maildir:%%h/maildir:INDEX=~/maildir/shared/%%u
  
  # Подписка по-умолчанию на пространство имен.  
  subscriptions = no
  
  # Показывать пространство имен shared/ по команде LIST, только если есть 
  # видимые почтовые ящики.
  list = children
}


###
## Процесс,работающий с письмами
##

# Список плагинов, разделенных пробелами, которые должны быть 
# загружены.
# ВАЖНО:Плагины специфичные для IMAP, LDA и т.п. включаются в других 
# (собственных) файлах конфигурации.
#
# Используемые плагины:
#	acl	- управление правами доступа для почтовых ящиков.
#	quota	- квоты на почтовые ящики
# 
mail_plugins = acl quota


###
### /conf.d/15-ldap.conf
###

##
## Параметры LDA (также используются для LMTP)
##

# Адрес, используемый для отправки отклоненных (rejection) писем.
# 
postmaster_address=root@example.com


###
### /conf.d/auth-master.conf.ext
###

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! Потом следует переделать на LDAP-хранение!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

##
## Аутентификация мастер-пользователей. Подключается из /conf.d/10-auth.conf
##

# Доступ к паролям мастер-пользователей.
#
passdb {
  
  # Используемая база данных. passwd-file - данные хранятся в файле. 
  driver = passwd-file
  
  # Задаем, что выбранная база данных - список мастер-пользователей. 
  master = yes
  
  # Путь до файла, содержащего список масте-пользователей.
  args = /etc/dovecot/master-users
  
  # Проверка, что почтовый аккаунт действительно существует, перед тем как
  # мастер-пользователь выполнит вход в него.
  #pass = yes
}


###
### /conf.d/auth-ldap.conf.ext
###

##
## Аутентификация LDAP-пользователей. Подключается из /conf.d/10-auth.conf
##

# Доступ к паролям пользователей.
#
passdb {
  
  # Используемая база данных.
  driver = ldap

  # Расположение файла конфигурации для подключения к базе данных.
  args = /etc/dovecot/dovecot-ldap.conf.ext
}

# Доступ к списку пользователей.
#
userdb {
  # Используемая база данных.
  driver = ldap

  # Расположение файла конфигурации для подключения к базе данных.
  args = /etc/dovecot/dovecot-ldap.conf.ext
}


###
### 
###

